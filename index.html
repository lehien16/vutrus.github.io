<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>V≈© tr·ª• ngh·ªÅ nghi·ªáp nh·ªã ph√¢n</title>
  <style>
    /* ƒê∆°n gi·∫£n h√≥a CSS cho v≈© tr·ª• */
    #universe {
      position: relative;
      height: 500px;
      background: #000;
      border: 1px solid #fff;
      overflow: hidden;
    }
    .star {
      position: absolute;
      color: #fff;
      font-size: 12px;
      font-family: Arial, sans-serif;
      text-align: center;
    }
    #stats {
      margin-top: 20px;
      color: #fff;
    }
  </style>
</head>
<body>
  <h1>V≈© tr·ª• ngh·ªÅ nghi·ªáp nh·ªã ph√¢n</h1>
  <div id="universe"></div>
  <br />
  <input type="text" id="binaryInput" placeholder="Nh·∫≠p d√£y nh·ªã ph√¢n" />
  <button onclick="addStar()">Th√™m ng√¥i sao</button>
  <div id="stats"></div>

  <!-- Firebase SDK (V9 tr·ªü l√™n) -->
  <script type="module">
    // Import c√°c module Firebase c·∫ßn thi·∫øt
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js';
    import { getDatabase, ref, push, onValue } from 'https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js';

    // C·∫•u h√¨nh Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyBtO7yMF8yhTkTv3faN0u1oNyJ0KpaBnsA",
      authDomain: "vu-tru-nghe-nghiep.firebaseapp.com",
      databaseURL: "https://vu-tru-nghe-nghiep-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "vu-tru-nghe-nghiep",
      storageBucket: "vu-tru-nghe-nghiep.firebasestorage.app",
      messagingSenderId: "248626863436",
      appId: "1:248626863436:web:00362f550042ef8dd743e9",
      measurementId: "G-3QDN201BBD"
    };

    // Kh·ªüi t·∫°o Firebase
    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);

    // Bi·∫øn ƒë·ªÉ ƒë·∫øm s·ªë ngh·ªÅ nghi·ªáp
    let careerCount = {};

    // H√†m chuy·ªÉn ƒë·ªïi nh·ªã ph√¢n th√†nh vƒÉn b·∫£n (ngh·ªÅ nghi·ªáp)
    function binaryToText(binary) {
      const binaryArray = binary.split(' ');
      return binaryArray.map(bin => {
        const num = parseInt(bin, 2);
        return String.fromCharCode(num);
      }).join('');
    }

    // H√†m th√™m ng√¥i sao (g·ª≠i d·ªØ li·ªáu l√™n Firebase)
    async function addStar() {
      const binaryInput = document.getElementById('binaryInput').value.trim();
      if (!binaryInput) return;

      const career = binaryToText(binaryInput); // Chuy·ªÉn nh·ªã ph√¢n th√†nh vƒÉn b·∫£n

      // L∆∞u d·ªØ li·ªáu v√†o Firebase
      const newData = {
        binary: binaryInput,
        career: career,
        timestamp: new Date().toISOString()
      };

      try {
        const starsRef = ref(database, 'stars');
        await push(starsRef, newData);
        console.log('D·ªØ li·ªáu ƒë√£ ƒë∆∞·ª£c l∆∞u v√†o Firebase');
      } catch (error) {
        console.error('L·ªói khi g·ª≠i d·ªØ li·ªáu l√™n Firebase', error);
      }

      document.getElementById('binaryInput').value = ''; // X√≥a √¥ input sau khi g·ª≠i
    }

    // H√†m v·∫Ω ng√¥i sao v√†o v≈© tr·ª•
    function renderStar(binary, career) {
      const universe = document.getElementById('universe');
      const star = document.createElement('div');
      star.classList.add('star');
      star.innerHTML = `${career}`;
      
      // T·∫°o ng√¥i sao v√† g√°n v·ªã tr√≠ ng·∫´u nhi√™n
      const randomAngle = Math.random() * 360;
      const randomDistance = 200 + Math.random() * 100;

      const x = randomDistance * Math.cos(randomAngle);
      const y = randomDistance * Math.sin(randomAngle);

      star.style.transform = `translate(${x}px, ${y}px)`;

      universe.appendChild(star);
    }

    // H√†m c·∫≠p nh·∫≠t th·ªëng k√™ s·ªë l∆∞·ª£ng ngh·ªÅ nghi·ªáp
    function updateStats() {
      let total = 0;
      for (const count of Object.values(careerCount)) {
        total += count;
      }

      let html = '<ul>';
      for (const career in careerCount) {
        const percent = ((careerCount[career] / total) * 100).toFixed(1);
        html += `<li><strong>${career}</strong>: ${careerCount[career]} l∆∞·ª£t (${percent}%)</li>`;
      }
      html += `</ul><p><strong>T·ªïng c·ªông:</strong> ${total} ngh·ªÅ nghi·ªáp ƒë√£ ƒë∆∞·ª£c g·ª≠i üöÄ</p>`;
      document.getElementById('stats').innerHTML = html;
    }

    // H√†m t·∫£i d·ªØ li·ªáu t·ª´ Firebase v√† hi·ªÉn th·ªã ng√¥i sao
    window.onload = function () {
      const starsRef = ref(database, 'stars');
      onValue(starsRef, function(snapshot) {
        const data = snapshot.val();
        if (data) {
          for (const key in data) {
            const item = data[key];
            renderStar(item.binary, item.career);  // Render ng√¥i sao
            if (!careerCount[item.career]) careerCount[item.career] = 0;
            careerCount[item.career]++;
          }
        }
        updateStats();  // C·∫≠p nh·∫≠t th·ªëng k√™
      });
    };
  </script>
</body>
</html>
